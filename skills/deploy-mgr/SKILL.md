# Deploy Mgr - è¿œç¨‹æœåŠ¡éƒ¨ç½²ç®¡ç†å·¥å…·

## åŠŸèƒ½ç‰¹ç‚¹

- **ç»Ÿä¸€ç®¡ç†**: é›†ä¸­ç®¡ç†æ‰€æœ‰è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„é¡¹ç›®éƒ¨ç½²
- **å¿«é€Ÿæ“ä½œ**: ä¸€é”®å¯åŠ¨ã€åœæ­¢ã€é‡å¯è¿œç¨‹æœåŠ¡
- **çŠ¶æ€ç›‘æ§**: å®æ—¶æŸ¥çœ‹æœåŠ¡è¿è¡ŒçŠ¶æ€
- **æ—¥å¿—æŸ¥çœ‹**: è¿œç¨‹æŸ¥çœ‹æœåŠ¡è¿è¡Œæ—¥å¿—
- **å¤šç§è®¤è¯**: æ”¯æŒå¯†ç å’Œ SSH å¯†é’¥è®¤è¯
- **æ•°æ®æŒä¹…åŒ–**: æœ¬åœ°è‡ªåŠ¨ä¿å­˜éƒ¨ç½²é…ç½®

## ğŸ¤– åœ¨ OpenClaw ä¸­ä½¿ç”¨

### è‡ªç„¶è¯­è¨€è°ƒç”¨ç¤ºä¾‹

**åˆ—å‡ºæ‰€æœ‰éƒ¨ç½²**:
```
æ˜¾ç¤ºæ‰€æœ‰éƒ¨ç½²åˆ—è¡¨
```

**æ·»åŠ éƒ¨ç½²**:
```
æ·»åŠ éƒ¨ç½²ï¼š
- é¡¹ç›®å: myapp
- æœåŠ¡å™¨: ws.flys.fun
- ç”¨æˆ·: root
- éƒ¨ç½²è·¯å¾„: /var/www/myapp
- å¯åŠ¨å‘½ä»¤: npm start
- ä½¿ç”¨ SSH å¯†é’¥ ~/.ssh/id_rsa
```

**æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€**:
```
æŸ¥çœ‹ myapp çš„çŠ¶æ€
```

**å¯åŠ¨æœåŠ¡**:
```
å¯åŠ¨ myapp æœåŠ¡
```

**åœæ­¢æœåŠ¡**:
```
åœæ­¢ myapp æœåŠ¡
```

**é‡å¯æœåŠ¡**:
```
é‡å¯ myapp æœåŠ¡
```

**æŸ¥çœ‹æ—¥å¿—**:
```
æŸ¥çœ‹ myapp çš„æ—¥å¿—ï¼Œæœ€è¿‘ 50 è¡Œ
```

**æŸ¥çœ‹éƒ¨ç½²è¯¦æƒ…**:
```
æ˜¾ç¤º myapp çš„è¯¦ç»†ä¿¡æ¯
```

**åˆ é™¤éƒ¨ç½²**:
```
åˆ é™¤ myapp éƒ¨ç½²
```

### OpenClaw å·¥ä½œåŸç†

å½“ä½ åœ¨ OpenClaw å¯¹è¯ä¸­æè¿°éƒ¨ç½²ç®¡ç†éœ€æ±‚æ—¶ï¼š

1. **è¯†åˆ«æ„å›¾**: OpenClaw è¯†åˆ«å‡ºä½ æƒ³è¦ç®¡ç†è¿œç¨‹éƒ¨ç½²
2. **è°ƒç”¨æŠ€èƒ½**: è‡ªåŠ¨è°ƒç”¨ Deploy Mgr æŠ€èƒ½
3. **è§£æå‚æ•°**: ä»è‡ªç„¶è¯­è¨€ä¸­æå–å…³é”®ä¿¡æ¯
4. **æ‰§è¡Œæ“ä½œ**: è¿æ¥è¿œç¨‹æœåŠ¡å™¨å¹¶æ‰§è¡Œå‘½ä»¤
5. **è¿”å›ç»“æœ**: å‘Šè¯‰ä½ æ“ä½œæ˜¯å¦æˆåŠŸ

### å…¸å‹å¯¹è¯ç¤ºä¾‹

**ç¤ºä¾‹ 1: æ·»åŠ æ–°éƒ¨ç½²**
```
ä½ : å¸®æˆ‘æ·»åŠ ä¸€ä¸ªéƒ¨ç½²

OpenClaw: å¥½çš„ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
         1. é¡¹ç›®åç§°
         2. æœåŠ¡å™¨åœ°å€
         3. ç”¨æˆ·å
         4. éƒ¨ç½²è·¯å¾„
         5. å¯åŠ¨å‘½ä»¤
         6. è®¤è¯æ–¹å¼ï¼ˆå¯†ç æˆ–SSHå¯†é’¥ï¼‰

ä½ : é¡¹ç›®åæ˜¯ test-apiï¼ŒæœåŠ¡å™¨æ˜¯ ws.flys.funï¼Œç”¨æˆ· rootï¼Œéƒ¨ç½²è·¯å¾„
    /var/www/test-apiï¼Œå¯åŠ¨å‘½ä»¤æ˜¯ python app.pyï¼Œä½¿ç”¨ SSH å¯†é’¥

OpenClaw: âœ“ éƒ¨ç½²æ·»åŠ æˆåŠŸï¼
         ID: 1
         åç§°: test-api
```

**ç¤ºä¾‹ 2: æŸ¥çœ‹å’Œç®¡ç†**
```
ä½ : æ˜¾ç¤ºæ‰€æœ‰éƒ¨ç½²

OpenClaw: ================================================================================
         ID    Name                 Host                      Path                          Description
         ================================================================================
         1     test-api             ws.flys.fun               /var/www/test-api             æµ‹è¯•APIæœåŠ¡

         Total: 1 deployment(s)

ä½ : å¯åŠ¨ test-api

OpenClaw: ================================================================================
         Start Service: test-api
         ================================================================================
         âœ… Service started successfully!
         ğŸ“ Message: Server started on port 3000
         ================================================================================
```

## ğŸ’» å‘½ä»¤è¡Œä½¿ç”¨

### å®‰è£…ä¾èµ–

```bash
pip install paramiko click
```

### åŸºæœ¬å‘½ä»¤

```bash
# åˆ—å‡ºæ‰€æœ‰éƒ¨ç½²
deploy-mgr list

# æ·»åŠ éƒ¨ç½²
deploy-mgr add \
  --name myapp \
  --host server.com \
  --username deploy \
  --auth-type key \
  --auth-data ~/.ssh/id_rsa \
  --deploy-path /var/www/myapp \
  --start-command "npm start" \
  --stop-command "npm stop" \
  --log-path /var/log/myapp/app.log

# æŸ¥çœ‹éƒ¨ç½²è¯¦æƒ…
deploy-mgr info myapp

# æŸ¥çœ‹çŠ¶æ€
deploy-mgr status myapp

# å¯åŠ¨æœåŠ¡
deploy-mgr start myapp

# åœæ­¢æœåŠ¡
deploy-mgr stop myapp

# é‡å¯æœåŠ¡
deploy-mgr restart myapp

# æŸ¥çœ‹æ—¥å¿—
deploy-mgr logs myapp
deploy-mgr logs myapp --lines 50

# æ›´æ–°éƒ¨ç½²
deploy-mgr update myapp --host new-server.com

# åˆ é™¤éƒ¨ç½²
deploy-mgr remove myapp
```

## ğŸš€ OpenClaw ç”¨æˆ·å¿«é€ŸæŒ‡å—

### å‚æ•°è¯´æ˜ï¼ˆè‡ªç„¶è¯­è¨€è¯†åˆ«ï¼‰

| å‚æ•° | è‡ªç„¶è¯­è¨€å…³é”®è¯ | ç¤ºä¾‹ |
|------|---------------|------|
| é¡¹ç›®åç§° | é¡¹ç›®å/æœåŠ¡å/åº”ç”¨å | "é¡¹ç›®åæ˜¯ myapp" |
| æœåŠ¡å™¨åœ°å€ | æœåŠ¡å™¨/ä¸»æœº/åœ°å€ | "æœåŠ¡å™¨ ws.flys.fun" |
| ç”¨æˆ·å | ç”¨æˆ·/ç”¨æˆ·å | "ç”¨æˆ· root" |
| éƒ¨ç½²è·¯å¾„ | éƒ¨ç½²è·¯å¾„/é¡¹ç›®è·¯å¾„ | "éƒ¨ç½²è·¯å¾„ /var/www" |
| å¯åŠ¨å‘½ä»¤ | å¯åŠ¨å‘½ä»¤/è¿è¡Œå‘½ä»¤ | "å¯åŠ¨å‘½ä»¤ npm start" |
| åœæ­¢å‘½ä»¤ | åœæ­¢å‘½ä»¤ | "åœæ­¢å‘½ä»¤ npm stop" |
| æ—¥å¿—è·¯å¾„ | æ—¥å¿—è·¯å¾„/æ—¥å¿—æ–‡ä»¶ | "æ—¥å¿—è·¯å¾„ /var/log/app.log" |
| SSH å¯†é’¥ | SSH å¯†é’¥/å¯†é’¥æ–‡ä»¶ | "ä½¿ç”¨ SSH å¯†é’¥ ~/.ssh/id_rsa" |

### å¸¸è§æ“ä½œæ¨¡å¼

**æ·»åŠ éƒ¨ç½²**:
```
æ·»åŠ  [é¡¹ç›®å] éƒ¨ç½²åˆ° [æœåŠ¡å™¨]ï¼Œç”¨æˆ· [ç”¨æˆ·å]ï¼Œè·¯å¾„ [è·¯å¾„]ï¼Œå¯åŠ¨å‘½ä»¤ [å‘½ä»¤]
```

**æŸ¥çœ‹çŠ¶æ€**:
```
æŸ¥çœ‹ [é¡¹ç›®å] çš„çŠ¶æ€
```

**å¯åœæœåŠ¡**:
```
å¯åŠ¨/åœæ­¢/é‡å¯ [é¡¹ç›®å]
```

**æŸ¥çœ‹æ—¥å¿—**:
```
æŸ¥çœ‹ [é¡¹ç›®å] çš„æ—¥å¿—
```

### æç¤ºå’ŒæŠ€å·§

1. **ç®€æ´è¡¨è¾¾**: ä¿¡æ¯è¶Šæ˜ç¡®ï¼Œè¯†åˆ«è¶Šå‡†ç¡®
2. **ä½¿ç”¨é¡¹ç›®å**: é€šè¿‡é¡¹ç›®åå¼•ç”¨éƒ¨ç½²æœ€æ–¹ä¾¿
3. **æå‰é…ç½®**: å»ºè®®åœ¨å¯åŠ¨å‘½ä»¤å’Œåœæ­¢å‘½ä»¤ä¸­åŒ…å«å®Œæ•´çš„æ‰§è¡Œè·¯å¾„
4. **æ—¥å¿—æ–‡ä»¶**: é…ç½®æ—¥å¿—è·¯å¾„å¯ä»¥å¿«é€ŸæŸ¥çœ‹é—®é¢˜

## ğŸ“ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: å¼€å‘ç¯å¢ƒéƒ¨ç½²

```bash
 deploy-mgr add \
   --name dev-api \
   --host dev-server.com \
   --username dev \
   --auth-type key \
   --auth-data ~/.ssh/dev_key \
   --deploy-path /home/dev/api \
   --start-command "pm2 start app.js" \
   --stop-command "pm2 stop app" \
   --log-path /var/log/dev-api/app.log
```

### åœºæ™¯2: ç”Ÿäº§ç¯å¢ƒç®¡ç†

```bash
# åˆ—å‡ºæ‰€æœ‰æœåŠ¡
deploy-mgr list

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
deploy-mgr status prod-api

# æ»šåŠ¨é‡å¯
deploy-mgr restart prod-api

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
deploy-mgr logs prod-api --lines 200
```

### åœºæ™¯3: æ‰¹é‡ç®¡ç†

å¯ä»¥é…åˆè„šæœ¬æ‰¹é‡æ“ä½œå¤šä¸ªéƒ¨ç½²ï¼š

```bash
# æ‰¹é‡å¯åŠ¨
for name in api web worker; do
  deploy-mgr start $name
done

# æ‰¹é‡æ£€æŸ¥çŠ¶æ€
for name in api web worker; do
  deploy-mgr status $name
done
```

## ğŸ”§ é…ç½®å’Œè®¤è¯

### è®¤è¯æ–¹å¼

#### 1. SSH å¯†é’¥è®¤è¯ï¼ˆæ¨èï¼‰
```bash
deploy-mgr add \
  --auth-type key \
  --auth-data ~/.ssh/id_rsa \
  ...
```

#### 2. å¯†ç è®¤è¯
```bash
deploy-mgr add \
  --auth-type password \
  --auth-data "your_password" \
  ...
```

### æ•°æ®å­˜å‚¨

éƒ¨ç½²æ•°æ®å­˜å‚¨åœ¨ï¼š
- **Windows**: `C:\Users\<ç”¨æˆ·å>\.deploy-mgr\deployments.db`
- **Linux/Mac**: `~/.deploy-mgr/deployments.db`

### å®‰å…¨æç¤º

1. âš ï¸ å¯†ç ä¼šæ˜æ–‡å­˜å‚¨åœ¨æœ¬åœ°æ•°æ®åº“ä¸­ï¼Œå»ºè®®ä½¿ç”¨ SSH å¯†é’¥è®¤è¯
2. ğŸ” ç¡®ä¿ `.deploy-mgr` ç›®å½•æƒé™æ­£ç¡®
3. ğŸ‘¤ å®šæœŸå®¡æŸ¥éƒ¨ç½²é…ç½®

## ğŸ“Š æ•°æ®ç»“æ„

### éƒ¨ç½²è®°å½•

```json
{
  "id": 1,
  "name": "myapp",
  "host": "server.com",
  "port": 22,
  "username": "deploy",
  "auth_type": "key",
  "auth_data": "/home/user/.ssh/id_rsa",
  "deploy_path": "/var/www/myapp",
  "start_command": "npm start",
  "stop_command": "npm stop",
  "status_command": null,
  "log_path": "/var/log/myapp/app.log",
  "description": "ç”Ÿäº§ç¯å¢ƒåº”ç”¨",
  "created_at": "2026-02-20 10:00:00",
  "updated_at": "2026-02-20 10:00:00"
}
```

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜1: è¿æ¥å¤±è´¥
- âœ… æ£€æŸ¥æœåŠ¡å™¨åœ°å€å’Œç«¯å£
- âœ… ç¡®è®¤ SSH æœåŠ¡è¿è¡Œä¸­
- âœ… éªŒè¯è®¤è¯ä¿¡æ¯æ­£ç¡®

### é—®é¢˜2: å‘½ä»¤æ‰§è¡Œå¤±è´¥
- âœ… æ£€æŸ¥éƒ¨ç½²è·¯å¾„æ˜¯å¦å­˜åœ¨
- âœ… éªŒè¯å‘½ä»¤åœ¨æœåŠ¡å™¨ä¸Šå¯ç”¨
- âœ… æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

### é—®é¢˜3: æ—¥å¿—æ–‡ä»¶æœªæ‰¾åˆ°
- âœ… ç¡®è®¤æ—¥å¿—è·¯å¾„é…ç½®æ­£ç¡®
- âœ… æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æƒé™
- âœ… éªŒè¯æ—¥å¿—æ–‡ä»¶å­˜åœ¨

## ğŸ“Œ å¸¸è§é—®é¢˜

**Q: å¦‚ä½•ä¿®æ”¹å·²æ·»åŠ çš„éƒ¨ç½²ï¼Ÿ**
```bash
deploy-mgr update myapp --new-option value
```

**Q: å¦‚ä½•å¤‡ä»½é…ç½®ï¼Ÿ**
ç›´æ¥å¤åˆ¶ `~/.deploy-mgr/` ç›®å½•å³å¯ã€‚

**Q: æ”¯æŒæ‰¹é‡æ“ä½œå—ï¼Ÿ**
å¯ä»¥é€šè¿‡ shell è„šæœ¬å®ç°æ‰¹é‡æ“ä½œã€‚

**Q: å¦‚ä½•æŸ¥çœ‹æ“ä½œå†å²ï¼Ÿ**
æ•°æ®åº“ä¸­çš„ `operation_logs` è¡¨è®°å½•äº†æ‰€æœ‰æ“ä½œã€‚

---

**ç‰ˆæœ¬**: 1.0.0
**å¼€å‘è€…**: OpenClaw
**è®¸å¯è¯**: MIT
